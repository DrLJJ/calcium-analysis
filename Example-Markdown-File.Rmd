---
title: "20180809MRS_CalciumAnalysis_CasRAndMutants"
author: "Michael Schamber"
date: "8/11/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(tidyr)
library(plyr)
library(MESS)
library(sandwich)
library(lmtest)
library(multcomp)
library(drc)
library(CalciumAnalysis)
```

## Goal/Purpose:

This was a repeat of calcium titrations of mouse Casr: Wild-type, C129S, and C129G + C131G to determine their EC50.

To improve consistency, I made 125mL of each calcium concentration so that it was uniform across all movies and not subject to slight variations.

Three movies were taken for each construct.



```{r import and clean data, include=FALSE}
setwd('D:/CellBasedImaging/RezaLab/20180809MRS_CasrCalciumTitrations_Wt_C129131G_C129S/Data/')

#Wild-Type
wholeCalciumExperiment26 <- normalizeCalciumData('WholeImage_Calcium_Experiment26.csv')
wholeNormInt26 <- wholeCalciumExperiment26[[1]]
longWholeNormInt26 <- wholeCalciumExperiment26[[2]]

wholeCalciumExperiment29 <- normalizeCalciumData('WholeImage_Calcium_Experiment29.csv')
wholeNormInt29 <- wholeCalciumExperiment29[[1]]
longWholeNormInt29 <- wholeCalciumExperiment29[[2]]

wholeCalciumExperiment31 <- normalizeCalciumData('WholeImage_Calcium_Experiment31.csv')
wholeNormInt31 <- wholeCalciumExperiment31[[1]]
longWholeNormInt31 <- wholeCalciumExperiment31[[2]]


#C129131G (i think)
wholeCalciumExperiment32 <- normalizeCalciumData('WholeImage_Calcium_Experiment32.csv')
wholeNormInt32 <- wholeCalciumExperiment32[[1]]
longWholeNormInt32 <- wholeCalciumExperiment32[[2]]

wholeCalciumExperiment33 <- normalizeCalciumData('WholeImage_Calcium_Experiment33.csv')
wholeNormInt33  <- wholeCalciumExperiment33[[1]]
longWholeNormInt33 <- wholeCalciumExperiment33[[2]]

wholeCalciumExperiment34 <- normalizeCalciumData('WholeImage_Calcium_Experiment34.csv')
wholeNormInt34 <- wholeCalciumExperiment34[[1]]
longWholeNormInt34 <- wholeCalciumExperiment34[[2]]

#C129S

wholeCalciumExperiment35 <- normalizeCalciumData('WholeImage_Calcium_Experiment35.csv')
wholeNormInt35 <- wholeCalciumExperiment35[[1]]
longWholeNormInt35 <- wholeCalciumExperiment35[[2]]

wholeCalciumExperiment36 <- normalizeCalciumData('WholeImage_Calcium_Experiment36.csv')
wholeNormInt36 <- wholeCalciumExperiment36[[1]]
longWholeNormInt36 <- wholeCalciumExperiment36[[2]]

wholeCalciumExperiment39 <- normalizeCalciumData('WholeImage_Calcium_Experiment39.csv')
wholeNormInt39 <- wholeCalciumExperiment39[[1]]
longWholeNormInt39 <- wholeCalciumExperiment39[[2]]
```

# Define the points that the conditions cahnged
```{r define conditions}
conditions26 <- c(50, 110, 165, 240, 300, 375, 440, 510, 570, 645)
conditions29 <- c(50, 115, 165,215, 270, 335, 400, 485, 560, 615)
conditions31 <- c(50, 100, 140, 205, 260, 320, 380,460, 555, 635)

conditions32 <- c(50, 115, 160, 235, 290, 370, 430, 492, 535, 621)
conditions33 <- c(55, 110, 175, 235, 280, 360, 430, 485, 535, 600)
conditions34 <- c(50,125, 175, 240, 285, 345, 397, 445, 34, 565)

conditions35 <- c(50, 110, 165, 225, 270, 318, 375, 420, 466, 535)
conditions36 <- c(40, 95, 135, 200, 240, 280, 330, 390, 435, 485)
conditions39 <- c(40, 120, 160, 220, 255, 320, 351, 430, 470, 530)
```

## Plotting of the Whole-FOV calcium data

# Wild-type

```{r}
plotsCellCalciumData(longWholeNormInt26, conditions26, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt29, conditions29, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt31,conditions31, 1)
```

# C129+131G

```{r}
plotsCellCalciumData(longWholeNormInt32, conditions32, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt33, conditions33, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt34, conditions34, 1)
```

# C129S

```{r}
plotsCellCalciumData(longWholeNormInt35, conditions35, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt36, conditions36, 1)
```
```{r}
plotsCellCalciumData(longWholeNormInt39, conditions39, 1)
```



# Integrate the Area Under the curve to measure strength of response

```{r Integrate Area as Response Measurement}

auc26.0 <- data.frame(integrateCurve(wholeNormInt26, 10, 40 ))
auc26.1 <- data.frame(integrateCurve(wholeNormInt26, 50, 110))
auc26.2 <- data.frame(integrateCurve(wholeNormInt26, 165, 240))
auc26.3 <- data.frame(integrateCurve(wholeNormInt26, 300, 375))
auc26.4 <- data.frame(integrateCurve(wholeNormInt26, 440, 510))
auc26.5 <- data.frame(integrateCurve(wholeNormInt26, 570, 645))

auc29.0 <- data.frame(integrateCurve(wholeNormInt29, 10, 45 ))
auc29.1 <- data.frame(integrateCurve(wholeNormInt29, 50, 115))
auc29.2 <- data.frame(integrateCurve(wholeNormInt29, 165, 215))
auc29.3 <- data.frame(integrateCurve(wholeNormInt29, 270, 335))
auc29.4 <- data.frame(integrateCurve(wholeNormInt29, 400, 485))
auc29.5 <- data.frame(integrateCurve(wholeNormInt29, 560, 615))

auc31.0 <- data.frame(integrateCurve(wholeNormInt31, 10, 45 ))
auc31.1 <- data.frame(integrateCurve(wholeNormInt31, 50, 100))
auc31.2 <- data.frame(integrateCurve(wholeNormInt31, 140, 205))
auc31.3 <- data.frame(integrateCurve(wholeNormInt31, 260, 320))
auc31.4 <- data.frame(integrateCurve(wholeNormInt31, 380, 460))
auc31.5 <- data.frame(integrateCurve(wholeNormInt31, 555, 635))

auc32.0 <- data.frame(integrateCurve(wholeNormInt32, 10, 40 ))
auc32.1 <- data.frame(integrateCurve(wholeNormInt32, 50, 115))
auc32.2 <- data.frame(integrateCurve(wholeNormInt32, 160, 235))
auc32.3 <- data.frame(integrateCurve(wholeNormInt32, 290, 370))
auc32.4 <- data.frame(integrateCurve(wholeNormInt32, 430, 492))
auc32.5 <- data.frame(integrateCurve(wholeNormInt32, 535, 621))

auc33.0 <- data.frame(integrateCurve(wholeNormInt26, 10, 40 ))
auc33.1 <- data.frame(integrateCurve(wholeNormInt26, 55, 110))
auc33.2 <- data.frame(integrateCurve(wholeNormInt26, 175, 235))
auc33.3 <- data.frame(integrateCurve(wholeNormInt26, 280, 360))
auc33.4 <- data.frame(integrateCurve(wholeNormInt26, 430, 485))
auc33.5 <- data.frame(integrateCurve(wholeNormInt26, 535, 600))

auc34.0 <- data.frame(integrateCurve(wholeNormInt34, 35, 45 ))
auc34.1 <- data.frame(integrateCurve(wholeNormInt34, 50, 125))
auc34.2 <- data.frame(integrateCurve(wholeNormInt34, 175, 240))
auc34.3 <- data.frame(integrateCurve(wholeNormInt34, 285, 345))
auc34.4 <- data.frame(integrateCurve(wholeNormInt34, 397, 445))
auc34.5 <- data.frame(integrateCurve(wholeNormInt34, 500, 565))

auc35.0 <- data.frame(integrateCurve(wholeNormInt35, 10, 40 ))
auc35.1 <- data.frame(integrateCurve(wholeNormInt35, 50, 110))
auc35.2 <- data.frame(integrateCurve(wholeNormInt35, 165, 225))
auc35.3 <- data.frame(integrateCurve(wholeNormInt35, 270, 318))
auc35.4 <- data.frame(integrateCurve(wholeNormInt35, 375, 420))
auc35.5 <- data.frame(integrateCurve(wholeNormInt35, 466, 535))

auc36.0 <- data.frame(integrateCurve(wholeNormInt29, 10, 30 ))
auc36.1 <- data.frame(integrateCurve(wholeNormInt29, 40, 95))
auc36.2 <- data.frame(integrateCurve(wholeNormInt29, 135, 200))
auc36.3 <- data.frame(integrateCurve(wholeNormInt29, 240, 280))
auc36.4 <- data.frame(integrateCurve(wholeNormInt29, 330, 390))
auc36.5 <- data.frame(integrateCurve(wholeNormInt29, 435, 485))

auc39.0 <- data.frame(integrateCurve(wholeNormInt32, 10, 30 ))
auc39.1 <- data.frame(integrateCurve(wholeNormInt32, 40, 120))
auc39.2 <- data.frame(integrateCurve(wholeNormInt32, 160, 220))
auc39.3 <- data.frame(integrateCurve(wholeNormInt32, 255, 320))
auc39.4 <- data.frame(integrateCurve(wholeNormInt32, 351, 430))
auc39.5 <- data.frame(integrateCurve(wholeNormInt32, 470, 530))




```


```{r Create Response Data frames}

response26 <- rbind(auc26.0, rbind(auc26.1, rbind(auc26.2, rbind(auc26.3, rbind(auc26.4, auc26.5)))))
response29 <- rbind(auc29.0, rbind(auc29.1, rbind(auc29.2, rbind(auc29.3, rbind(auc29.4, auc29.5)))))
response31 <- rbind(auc31.0, rbind(auc31.1, rbind(auc31.2, rbind(auc31.3, rbind(auc31.4, auc31.5)))))                     

response32 <- rbind(auc32.0, rbind(auc32.1, rbind(auc32.2, rbind(auc32.3, rbind(auc32.4, auc32.5)))))
response33 <- rbind(auc33.0, rbind(auc33.1, rbind(auc33.2, rbind(auc33.3, rbind(auc33.4, auc33.5)))))
response34 <- rbind(auc34.0, rbind(auc34.1, rbind(auc34.2, rbind(auc34.3, rbind(auc34.4, auc34.5)))))

response35 <- rbind(auc35.0, rbind(auc35.1, rbind(auc35.2, rbind(auc35.3, rbind(auc35.4, auc35.5)))))  
response36 <- rbind(auc36.0, rbind(auc36.1, rbind(auc36.2, rbind(auc36.3, rbind(auc36.4, auc36.5)))))
response39 <- rbind(auc39.0, rbind(auc39.1, rbind(auc39.2, rbind(auc39.3, rbind(auc39.4, auc39.5)))))

```


```{r Create Dose Response Curves}


long26 <- data.frame(t(response26))
colnames(long26) <- c(0.5, 2, 4, 8, 10, 20)

superlong26 <- long26 %>%
  gather(key = "Concentration", value = "Response" )

superlong26$Concentration <- as.numeric(superlong26$Concentration)

calcium26.LL.4 <- drm(Response ~ Concentration, data = superlong26, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))



long29 <- data.frame(t(response29))
colnames(long29) <- c(0.5, 2, 4, 8, 10, 20)

superlong29 <- long29 %>%
  gather(key = "Concentration", value = "Response" )

superlong29$Concentration <- as.numeric(superlong29$Concentration)

calcium29.LL.4 <- drm(Response ~ Concentration, data = superlong29, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))

long31 <- data.frame(t(response31))
colnames(long31) <- c(0.5, 2, 4, 8, 10, 20)

superlong31 <- long31 %>%
  gather(key = "Concentration", value = "Response" )

superlong31$Concentration <- as.numeric(superlong31$Concentration)

calcium31.LL.4 <- drm(Response ~ Concentration, data = superlong31, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))



long32 <- data.frame(t(response32))
colnames(long32) <- c(0.5, 2, 4, 8, 10, 20)

superlong32 <- long32 %>%
  gather(key = "Concentration", value = "Response" )

superlong32$Concentration <- as.numeric(superlong32$Concentration)

calcium32.LL.4 <- drm(Response ~ Concentration, data = superlong32, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))

long33 <- data.frame(t(response33))
colnames(long33) <- c(0.5, 2, 4, 8, 10, 20)

superlong33 <- long33 %>%
  gather(key = "Concentration", value = "Response" )

superlong33$Concentration <- as.numeric(superlong33$Concentration)

calcium33.LL.4 <- drm(Response ~ Concentration, data = superlong33, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))

long34 <- data.frame(t(response34))
colnames(long34) <- c(0.5, 2, 4, 8, 10, 20)

superlong34 <- long34 %>%
  gather(key = "Concentration", value = "Response" )

superlong34$Concentration <- as.numeric(superlong34$Concentration)

calcium34.LL.4 <- drm(Response ~ Concentration, data = superlong34, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))



long35 <- data.frame(t(response35))
colnames(long35) <- c(0.5, 2, 4, 8, 10, 20)

superlong35 <- long35 %>%
  gather(key = "Concentration", value = "Response" )

superlong35$Concentration <- as.numeric(superlong35$Concentration)

calcium35.LL.4 <- drm(Response ~ Concentration, data = superlong35, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))




long36 <- data.frame(t(response36))
colnames(long36) <- c(0.5, 2, 4, 8, 10, 20)

superlong36 <- long36 %>%
  gather(key = "Concentration", value = "Response" )

superlong36$Concentration <- as.numeric(superlong36$Concentration)

calcium36.LL.4 <- drm(Response ~ Concentration, data = superlong36, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))




long39 <- data.frame(t(response39))
colnames(long39) <- c(0.5, 2, 4, 8, 10, 20)

superlong39 <- long39 %>%
  gather(key = "Concentration", value = "Response" )

superlong39$Concentration <- as.numeric(superlong39$Concentration)

calcium39.LL.4 <- drm(Response ~ Concentration, data = superlong39, fct = LL.4(names=c('Slope','Lower Limit','Upper Limit','ED50')))





```


```{r DRC Summaries and Plots}


summary(calcium26.LL.4)
plot(calcium26.LL.4)

summary(calcium29.LL.4)
plot(calcium29.LL.4)

summary(calcium31.LL.4)
plot(calcium31.LL.4)

summary(calcium32.LL.4)
plot(calcium32.LL.4)

summary(calcium33.LL.4)
plot(calcium33.LL.4)

summary(calcium34.LL.4)
plot(calcium34.LL.4)

summary(calcium35.LL.4)
plot(calcium35.LL.4)

summary(calcium36.LL.4)
plot(calcium36.LL.4)


summary(calcium39.LL.4)
plot(calcium39.LL.4)


```

```{r Make dataframe of EC50 results for easy viewing, echo=FALSE}
# results<-c()
# results$experiment <- c('Experiment26', 'Experiment29', 'Experiment33', 'Experiment36', 'Experiment31',
#                         'Experiment32', 'Experiment29', 'Experiment34', 'Experiment35')
# results$construct <- c('Wild-type', 'Wild-type', 'Wild-type', 'Wild-type', 'Wild-type', 'C129S', 'C129S', 'C129131G', 'C129131G')
# results$EC.50 <- c(3.43, 3.52, 4.1, 3.77, 3.22, 2.69, 3.14, 2.82, 2.71)
# results$ste <- c(0.48, 0.21, 0.24, 0.17, 0.22, 0.32, 0.24, 0.33, 0.28)
# results$p.value <- c(0.089, 0.037, 2.2E-16, 2.2E-16, 0.043, 0.076, 2.2E-16, 2.7E-10, 4.82E-10)
# results<-data.frame(results)
```


# Conclusions & Summarized Results table

### Results Table

```{r}
# knitr::kable(results, format = "html") %>%
#   kableExtra::kable_styling(bootstrap_options = "striped", full_width = F)

```

